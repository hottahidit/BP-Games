<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lights Out</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2rem;
      background-color: #f5f5f5;
    }

    .grid {
      display: grid;
      gap: 2px;
      margin: 0 auto;
      width: fit-content;
    }

    .cell {
      width: 50px;
      height: 50px;
      background-color: #ccc;
      border: 1px solid #999;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      user-select: none;
    }

    .cell.on {
      background-color: yellow;
    }

    .cell.off {
      background-color: #333;
    }

    h1 {
      margin-bottom: 1rem;
    }
  </style>

    <h1>Lights Off</h1>

    <div class="info">
        <span><strong>Time:</strong> <span id="timer">0</span> seconds</span> 
    </div> <br>

    <div class="controls">
        <select id="difficulty">
        <option value="easy">Easy</option>
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
        </select>
        <button onclick="restart()">Restart</button>
    </div>
    <br>
    <div id="grid" class="grid"></div>
  
    <script>
        let rows = 10, cols = 10, grid = [];
        let timer = 0, timerInterval = null, timerStarted = false;

        const timerEl = document.getElementById("timer");
        const gridEl = document.getElementById('grid');

        function startTimer() {
            if (timerStarted) return;
            timerStarted = true;
            timerInterval = setInterval(() => {
                timer++;
                timerEl.textContent = timer;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function restart() {
            const difficulty = document.getElementById("difficulty").value;
            fetch(`/lights-off-reset?mode=${difficulty}`)
                .then(res => res.json())
                .then(data => {
                    rows = data.rows;
                    cols = data.cols;
                    grid = data.grid;
                    timer = 0;
                    timerStarted = false;
                    timerEl.textContent = "0";
                    renderGrid();
                });
        }

        function renderGrid() {
            gridEl.innerHTML = "";
            gridEl.style.gridTemplateColumns = `repeat(${cols}, 50px)`;
            gridEl.style.gridTemplateRows = `repeat(${rows}, 50px)`;

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.classList.add(grid[r][c] ? 'on' : 'off');
                    cell.dataset.row = r;
                    cell.dataset.col = c;

                    cell.addEventListener('click', () => {
                        startTimer();
                        fetch('/lights-off-toggle', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({row: r, col: c})
                        })
                        .then(res => res.json())
                        .then(data => {
                            grid = data.grid;
                            renderGrid();
                            if (data.win) {
                                alert("ðŸŽ‰ You Win!");
                                stopTimer();
                            }
                        });
                    });

                    gridEl.appendChild(cell);
                }
            }
        }

        // Initial load
        fetch('/lights-off-reset?mode=easy')
            .then(res => res.json())
            .then(data => {
                rows = data.rows;
                cols = data.cols;
                grid = data.grid;
                timer = 0;
                timerStarted = false;
                timerEl.textContent = "0";
                renderGrid();
            });
    </script>
</head>
</html>